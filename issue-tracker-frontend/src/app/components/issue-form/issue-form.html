<div class="min-h-screen bg-gray-50">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center min-h-96">
      <div class="bg-white rounded-xl shadow-lg p-12 text-center max-w-md w-full">
        <mat-spinner diameter="60" class="mx-auto mb-6"></mat-spinner>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">Loading Issue Data...</h3>
        <p class="text-gray-500">Please wait while we fetch the issue information.</p>
      </div>
    </div>

    <!-- Form Content -->
    <div *ngIf="!loading">
      
      <!-- Header Section -->
      <div class="mb-8">
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
          <!-- Back Button & Title -->
          <div class="flex items-start gap-4 flex-1">
            <button 
              mat-icon-button
              (click)="cancel()"
              class="mt-1 text-blue-600 hover:bg-blue-50 transition-all"
              matTooltip="Back to Issues List">
              <mat-icon>arrow_back</mat-icon>
            </button>
            <div>
              <div class="flex items-center gap-3 mb-2">
                <mat-icon class="text-3xl text-blue-500">
                  {{ isEditMode ? 'edit' : 'add_circle' }}
                </mat-icon>
                <h1 class="text-3xl lg:text-4xl font-bold text-gray-800">
                  {{ isEditMode ? 'Edit Issue' : 'Create New Issue' }}
                </h1>
              </div>
              <p class="text-gray-600">
                {{ isEditMode ? 'Update the issue details below' : 'Fill in the details to create a new issue' }}
              </p>
            </div>
          </div>
          
          <!-- Quick Actions (Development) -->
          <div class="flex gap-2" *ngIf="!isEditMode">
            <button 
              mat-button
              (click)="quickFillForTesting()"
              class="text-purple-600 hover:bg-purple-50 transition-all"
              matTooltip="Fill form with sample data">
              <mat-icon>science</mat-icon>
              Quick Fill
            </button>
          </div>
        </div>
      </div>

      <!-- Form Card -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        
        <!-- Form Header -->
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-8 py-6">
          <h2 class="text-2xl font-semibold text-white flex items-center gap-3">
            <mat-icon class="text-white text-2xl">assignment</mat-icon>
            {{ isEditMode ? 'Issue Details' : 'New Issue Information' }}
          </h2>
          <p class="text-blue-100 mt-2">
            {{ isEditMode ? 'Modify the fields you want to update' : 'All fields marked with * are required' }}
          </p>
        </div>

        <!-- Form Content -->
        <div class="p-8">
          <form [formGroup]="issueForm" (ngSubmit)="onSubmit()" class="space-y-8">
            
            <!-- Title Field -->
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                <mat-icon class="text-blue-500 text-lg">title</mat-icon>
                Issue Title *
              </label>
              <mat-form-field appearance="outline" class="w-full">
                <input 
                  matInput 
                  formControlName="title"
                  placeholder="Enter a clear, descriptive title for the issue"
                  maxlength="200"
                  class="text-base">
                <mat-hint class="flex justify-between items-center">
                  <span>Keep it concise but descriptive</span>
                  <span [class]="getCharacterCountClass('title', 200)">
                    {{ issueForm.get('title')?.value?.length || 0 }}/200
                  </span>
                </mat-hint>
                <mat-error *ngIf="hasError('title', 'required')">
                  Title is required
                </mat-error>
                <mat-error *ngIf="hasError('title', 'minlength')">
                  Title must be at least 3 characters long
                </mat-error>
                <mat-error *ngIf="hasError('title', 'maxlength')">
                  Title cannot exceed 200 characters
                </mat-error>
                <mat-error *ngIf="hasError('title', 'whitespace')">
                  Title cannot be empty or just whitespace
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Description Field -->
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                  <mat-icon class="text-green-500 text-lg">description</mat-icon>
                  Description
                </label>
                <button 
                  type="button"
                  mat-button
                  (click)="previewDescription()"
                  [disabled]="!issueForm.get('description')?.value?.trim()"
                  class="text-xs text-blue-600 hover:bg-blue-50 transition-all">
                  <mat-icon class="text-sm">visibility</mat-icon>
                  Preview
                </button>
              </div>
              <mat-form-field appearance="outline" class="w-full">
                <textarea 
                  matInput 
                  formControlName="description"
                  placeholder="Provide detailed information about the issue...&#10;&#10;• What is the problem?&#10;• When does it occur?&#10;• Steps to reproduce&#10;• Expected vs actual behavior"
                  rows="6"
                  maxlength="1000"
                  class="text-base leading-relaxed resize-none">
                </textarea>
                <mat-hint class="flex justify-between items-center">
                  <span>Detailed descriptions help resolve issues faster</span>
                  <span [class]="getCharacterCountClass('description', 1000)">
                    {{ issueForm.get('description')?.value?.length || 0 }}/1000
                  </span>
                </mat-hint>
                <mat-error *ngIf="hasError('description', 'maxlength')">
                  Description cannot exceed 1000 characters
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Status and Priority Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              
              <!-- Status Field -->
              <div class="space-y-2">
                <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                  <mat-icon class="text-purple-500 text-lg">flag</mat-icon>
                  Status *
                </label>
                <mat-form-field appearance="outline" class="w-full">
                  <mat-select formControlName="status" class="text-base">
                    <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                      <div class="flex items-center gap-3 py-1">
                        <mat-icon [class]="status.color" class="text-lg">{{ status.icon }}</mat-icon>
                        <span class="font-medium">{{ status.label }}</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-hint>Current status of the issue</mat-hint>
                  <mat-error *ngIf="hasError('status', 'required')">
                    Status is required
                  </mat-error>
                </mat-form-field>
              </div>

              <!-- Priority Field -->
              <div class="space-y-2">
                <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                  <mat-icon class="text-orange-500 text-lg">priority_high</mat-icon>
                  Priority *
                </label>
                <mat-form-field appearance="outline" class="w-full">
                  <mat-select formControlName="priority" class="text-base">
                    <mat-option *ngFor="let priority of priorityOptions" [value]="priority.value">
                      <div class="flex items-center gap-3 py-1">
                        <mat-icon [class]="priority.color" class="text-lg">{{ priority.icon }}</mat-icon>
                        <span class="font-medium">{{ priority.label }}</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-hint>How urgent is this issue?</mat-hint>
                  <mat-error *ngIf="hasError('priority', 'required')">
                    Priority is required
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <!-- Assignee Field -->
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
                <mat-icon class="text-indigo-500 text-lg">person</mat-icon>
                Assignee
              </label>
              <mat-form-field appearance="outline" class="w-full">
                <input 
                  matInput 
                  formControlName="assignee"
                  placeholder="Enter email address of the person responsible"
                  maxlength="100"
                  class="text-base">
                <mat-hint class="flex justify-between items-center">
                  <span>Leave empty if unassigned</span>
                  <span [class]="getCharacterCountClass('assignee', 100)">
                    {{ issueForm.get('assignee')?.value?.length || 0 }}/100
                  </span>
                </mat-hint>
                <mat-error *ngIf="hasError('assignee', 'maxlength')">
                  Assignee cannot exceed 100 characters
                </mat-error>
                <mat-error *ngIf="hasError('assignee', 'email')">
                  Please enter a valid email address
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Form Status Indicator -->
            <div class="bg-gray-50 rounded-lg p-4 border-l-4" 
                 [class]="issueForm.valid ? 'border-green-400' : 'border-orange-400'">
              <div class="flex items-center gap-3">
                <mat-icon [class]="issueForm.valid ? 'text-green-500' : 'text-orange-500'">
                  {{ issueForm.valid ? 'check_circle' : 'warning' }}
                </mat-icon>
                <div>
                  <h4 class="font-medium" [class]="issueForm.valid ? 'text-green-800' : 'text-orange-800'">
                    {{ issueForm.valid ? 'Form is ready to submit' : 'Please complete the required fields' }}
                  </h4>
                  <p class="text-sm" [class]="issueForm.valid ? 'text-green-600' : 'text-orange-600'">
                    {{ issueForm.valid ? 
                       'All required information has been provided' : 
                       'Check the highlighted fields above' }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pt-6 border-t border-gray-200">
              
              <!-- Left Actions -->
              <div class="flex gap-3">
                <button 
                  type="button" 
                  mat-button
                  (click)="resetForm()"
                  [disabled]="saving"
                  class="flex items-center gap-2 px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                  <mat-icon>refresh</mat-icon>
                  Reset Form
                </button>
              </div>

              <!-- Right Actions -->
              <div class="flex gap-4">
                <button 
                  type="button" 
                  mat-button
                  (click)="cancel()"
                  [disabled]="saving"
                  class="flex items-center gap-2 px-6 py-3 text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                  Cancel
                </button>
                
                <button 
                  type="submit" 
                  mat-raised-button 
                  color="primary"
                  [disabled]="issueForm.invalid || saving"
                  class="flex items-center gap-2 px-8 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  
                  <!-- Loading Spinner -->
                  <mat-spinner 
                    *ngIf="saving" 
                    diameter="20" 
                    class="mr-2">
                  </mat-spinner>
                  
                  <!-- Submit Icon -->
                  <mat-icon *ngIf="!saving">
                    {{ isEditMode ? 'save' : 'add_circle' }}
                  </mat-icon>
                  
                  <!-- Submit Text -->
                  {{ saving ? 
                     (isEditMode ? 'Updating Issue...' : 'Creating Issue...') : 
                     (isEditMode ? 'Update Issue' : 'Create Issue') }}
                </button>
              </div>
            </div>

          </form>
        </div>
      </div>

      <!-- Form Debug Info (Development Only) -->
      <div class="mt-8 bg-gray-800 text-green-400 rounded-lg p-6 font-mono text-xs" *ngIf="false">
        <h3 class="text-white font-bold mb-4">🐛 Debug Information</h3>
        <div class="space-y-2">
          <div><strong>Form Valid:</strong> {{ issueForm.valid }}</div>
          <div><strong>Form Dirty:</strong> {{ issueForm.dirty }}</div>
          <div><strong>Form Touched:</strong> {{ issueForm.touched }}</div>
          <div><strong>Is Edit Mode:</strong> {{ isEditMode }}</div>
          <div><strong>Issue ID:</strong> {{ issueId || 'N/A' }}</div>
          <div><strong>Form Value:</strong></div>
          <pre class="text-xs mt-2 p-2 bg-gray-900 rounded">{{ issueForm.value | json }}</pre>
        </div>
      </div>
    </div>
  </div>
</div>
