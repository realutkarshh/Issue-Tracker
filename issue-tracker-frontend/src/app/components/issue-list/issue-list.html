<div class="min-h-screen bg-black font-['Poppins']">
  <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-8">
    <!-- Header Section -->
    <div class="mb-4 sm:mb-6 lg:mb-8">
      <div class="flex flex-col space-y-4 sm:space-y-0 sm:flex-row sm:justify-between sm:items-start">
        <div class="space-y-1 sm:space-y-2">
          <h1 class="text-lg sm:text-xl lg:text-2xl font-semibold text-gray-100">Issues</h1>
          <p class="text-gray-500 text-xs sm:text-sm">Track and manage your project issues</p>
        </div>

        <!-- Action Buttons - Removed Test Connection -->
        <div class="flex flex-col space-y-2 sm:space-y-0 sm:flex-row sm:space-x-2 lg:space-x-3 w-full sm:w-auto">
          <button
            mat-stroked-button
            (click)="refreshIssues()"
            [disabled]="loading"
            class="!border-gray-800 !text-gray-400 hover:!bg-gray-900 hover:!text-gray-300 !px-3 !py-2.5 !text-xs sm:!text-sm !font-medium flex-1 sm:flex-initial"
          >
            <mat-icon class="!text-sm sm:!text-base mr-1 sm:mr-2">refresh</mat-icon>
            <span>Refresh</span>
          </button>
          <button
            mat-flat-button
            (click)="createIssue()"
            class="!bg-blue-600 hover:!bg-blue-500 !text-white !px-4 !py-2.5 !font-semibold !text-xs sm:!text-sm !shadow-lg !shadow-blue-600/20 flex-1 sm:flex-initial"
          >
            <mat-icon class="!text-sm sm:!text-base mr-1 sm:mr-2">add</mat-icon>
            <span class="sm:hidden">Create</span>
            <span class="hidden sm:inline">Create Issue</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Filters Section - Fixed Clear Button Layout -->
    <div
      *ngIf="!loading && !error"
      class="mb-4 sm:mb-6 bg-gray-950 rounded-lg border border-gray-800 p-3 sm:p-4 lg:p-6 shadow-2xl"
    >
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 xl:grid-cols-6 gap-3 sm:gap-4">
        <!-- Search Box - Full width on mobile -->
        <div class="sm:col-span-2 lg:col-span-2 xl:col-span-2">
          <label for="search" class="block text-xs sm:text-sm font-medium text-gray-400 mb-1.5 sm:mb-2">
            Search issues
          </label>
          <div class="relative">
            <input
              id="search"
              type="text"
              [formControl]="searchControl"
              placeholder="Search by title, ID, or assignee"
              class="w-full px-3 py-2.5 pl-10 border border-gray-800 rounded-lg text-xs sm:text-sm placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 bg-black text-gray-300"
            />
            <svg
              class="absolute left-3 top-3 w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
          </div>
        </div>

        <!-- Status Filter -->
        <div>
          <label for="status" class="block text-xs sm:text-sm font-medium text-gray-400 mb-1.5 sm:mb-2">Status</label>
          <select
            id="status"
            [formControl]="statusFilter"
            class="w-full px-3 py-2.5 border border-gray-800 rounded-lg text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 bg-black text-gray-300"
          >
            <option value="">All Statuses</option>
            <option *ngFor="let status of statusOptions" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>
        </div>

        <!-- Priority Filter -->
        <div>
          <label for="priority" class="block text-xs sm:text-sm font-medium text-gray-400 mb-1.5 sm:mb-2">Priority</label>
          <select
            id="priority"
            [formControl]="priorityFilter"
            class="w-full px-3 py-2.5 border border-gray-800 rounded-lg text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 bg-black text-gray-300"
          >
            <option value="">All Priorities</option>
            <option *ngFor="let priority of priorityOptions" [value]="priority">
              {{ priority | titlecase }}
            </option>
          </select>
        </div>

        <!-- Assignee Filter -->
        <div class="sm:col-span-2 lg:col-span-1 xl:col-span-1">
          <label for="assignee" class="block text-xs sm:text-sm font-medium text-gray-400 mb-1.5 sm:mb-2">Assignee</label>
          <select
            id="assignee"
            [formControl]="assigneeFilter"
            class="w-full px-3 py-2.5 border border-gray-800 rounded-lg text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 bg-black text-gray-300"
          >
            <option value="">All Assignees</option>
            <option value="unassigned">Unassigned</option>
            <option *ngFor="let assignee of assigneeOptions" [value]="assignee">
              {{ assignee }}
            </option>
          </select>
        </div>

        <!-- Clear Filter Button (separate column) -->
        <div class="sm:col-span-2 lg:col-span-1 xl:col-span-1 flex items-end">
          <button
            (click)="clearFilters()"
            [disabled]="!hasActiveFilters()"
            class="w-full lg:w-auto inline-flex items-center justify-center px-4 py-2.5 text-xs sm:text-sm border border-gray-800 text-gray-400 bg-black hover:bg-gray-900 hover:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-black whitespace-nowrap"
          >
            <svg class="w-3 h-3 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
            <span class="hidden sm:inline">Clear Filters</span>
            <span class="sm:hidden">Clear</span>
          </button>
        </div>
      </div>

      <!-- Filter Summary -->
      <div
        *ngIf="hasActiveFilters() || dataSource.filter"
        class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-800"
      >
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0">
          <div class="text-xs sm:text-sm text-gray-500">
            Showing <span class="font-medium text-gray-300">{{ getFilteredCount() }}</span> of
            <span class="font-medium text-gray-300">{{ totalIssues }}</span> issues
          </div>
          <div
            *ngIf="hasActiveFilters()"
            class="flex items-center space-x-2 text-xs sm:text-sm text-gray-500"
          >
            <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"
              ></path>
            </svg>
            <span>Filters active</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-8 sm:py-12 lg:py-16">
      <mat-spinner diameter="28" class="!text-gray-600 mb-3 sm:mb-4"></mat-spinner>
      <p class="text-gray-500 text-xs sm:text-sm">Loading issues...</p>
    </div>

    <!-- Error State -->
    <div
      *ngIf="error && !loading"
      class="bg-red-950 border-l-4 border-red-600 p-3 sm:p-4 mb-4 sm:mb-6 lg:mb-8 rounded-r-lg"
    >
      <div class="flex items-start">
        <mat-icon class="text-red-400 mr-2 sm:mr-3 mt-0.5 !text-base sm:!text-lg lg:!text-xl">error_outline</mat-icon>
        <div class="flex-1 min-w-0">
          <h3 class="text-red-300 font-medium text-xs sm:text-sm lg:text-base">Connection Failed</h3>
          <p class="text-red-200 text-xs sm:text-sm mt-1">{{ error }}</p>
          <button
            mat-stroked-button
            (click)="refreshIssues()"
            class="!border-red-600 !text-red-300 hover:!bg-red-900 !px-3 !py-1.5 !text-xs sm:!text-sm mt-2 sm:mt-3"
          >
            Try Again
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && issues.length === 0" class="text-center py-8 sm:py-12 lg:py-16">
      <div class="w-10 h-10 sm:w-12 sm:h-12 lg:w-16 lg:h-16 mx-auto mb-3 sm:mb-4 bg-gray-900 rounded-full flex items-center justify-center">
        <mat-icon class="text-gray-600 !text-lg sm:!text-xl lg:!text-2xl">inbox</mat-icon>
      </div>
      <h3 class="text-gray-200 font-medium mb-2 text-sm sm:text-base lg:text-lg">No issues yet</h3>
      <p class="text-gray-500 text-xs sm:text-sm mb-4 sm:mb-6">Get started by creating your first issue</p>
      <button
        mat-flat-button
        (click)="createIssue()"
        class="!bg-blue-600 !text-white !px-4 sm:!px-6 !py-2 !shadow-lg !shadow-blue-600/20 !text-xs sm:!text-sm"
      >
        <mat-icon class="mr-2 !text-sm sm:!text-base">add</mat-icon>
        Create Issue
      </button>
    </div>

    <!-- No Results State -->
    <div
      *ngIf="!loading && !error && issues.length > 0 && getFilteredCount() === 0"
      class="text-center py-8 sm:py-12 lg:py-16"
    >
      <div class="w-10 h-10 sm:w-12 sm:h-12 lg:w-16 lg:h-16 mx-auto mb-3 sm:mb-4 bg-gray-900 rounded-full flex items-center justify-center">
        <mat-icon class="text-gray-600 !text-lg sm:!text-xl lg:!text-2xl">search_off</mat-icon>
      </div>
      <h3 class="text-gray-200 font-medium mb-2 text-sm sm:text-base lg:text-lg">No issues found</h3>
      <p class="text-gray-500 text-xs sm:text-sm mb-4 sm:mb-6">Try adjusting your search criteria or filters</p>
      <button
        mat-stroked-button
        (click)="clearFilters()"
        class="!border-gray-800 !text-gray-400 hover:!bg-gray-900 hover:!text-gray-300 !text-xs sm:!text-sm"
      >
        <mat-icon class="mr-2 !text-sm sm:!text-base">clear</mat-icon>
        Clear Filters
      </button>
    </div>

    <!-- Mobile-First Responsive Issues Table -->
    <div
      *ngIf="!loading && !error && issues.length > 0 && getFilteredCount() > 0"
      class="bg-gray-950 rounded-lg border border-gray-800 overflow-hidden shadow-2xl"
    >
      <!-- Desktop Table View (hidden on mobile) -->
      <div class="hidden lg:block overflow-x-auto">
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          class="min-w-full divide-y divide-gray-800 !bg-gray-950"
        >
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="!px-6 !py-4 !text-left !font-medium !text-gray-400 !text-sm !bg-black !border-gray-800"
            >
              ID
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !whitespace-nowrap !bg-gray-950 !text-gray-500 !border-gray-800 cursor-pointer"
              (click)="viewIssue(issue)"
            >
              <span class="text-gray-600 text-sm font-mono" [title]="'#' + issue.id">
                #{{ truncateId(issue.id) }}
              </span>
            </td>
          </ng-container>

          <!-- Title Column - Enhanced Size -->
          <ng-container matColumnDef="title">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="!px-6 !py-4 !text-left !font-medium !text-gray-400 !text-sm !bg-black !min-w-[300px] !border-gray-800"
            >
              Title
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !max-w-[400px] !bg-gray-950 !text-gray-100 !border-gray-800 cursor-pointer"
              (click)="viewIssue(issue)"
            >
              <div class="group">
                <h4 class="font-semibold text-gray-100 group-hover:text-blue-400 transition-colors text-base lg:text-lg leading-tight">
                  {{ issue.title }}
                </h4>
                <p class="text-gray-500 text-sm mt-1.5 line-clamp-2" *ngIf="issue.description">
                  {{ issue.description | slice : 0 : 100 }}{{ issue.description.length > 100 ? '...' : '' }}
                </p>
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="!px-6 !py-4 !text-left !font-medium !text-gray-400 !text-sm !bg-black !whitespace-nowrap !border-gray-800"
            >
              Status
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !whitespace-nowrap !bg-gray-950 !text-gray-100 !border-gray-800 cursor-pointer"
              (click)="viewIssue(issue)"
            >
              <span
                class="inline-flex items-center px-2.5 py-1.5 rounded-full text-xs font-medium border"
                [ngStyle]="getStatusStyles(issue.status)"
              >
                {{ issue.status | titlecase }}
              </span>
            </td>
          </ng-container>

          <!-- Priority Column -->
          <ng-container matColumnDef="priority">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="!px-6 !py-4 !text-left !font-medium !text-gray-400 !text-sm !bg-black !whitespace-nowrap !border-gray-800"
            >
              Priority
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !whitespace-nowrap !bg-gray-950 !text-gray-100 !border-gray-800 cursor-pointer"
              (click)="viewIssue(issue)"
            >
              <span
                class="inline-flex items-center px-2.5 py-1.5 rounded-full text-xs font-medium border"
                [ngStyle]="getPriorityStyles(issue.priority)"
              >
                {{ issue.priority | titlecase }}
              </span>
            </td>
          </ng-container>

          <!-- Assignee Column -->
          <ng-container matColumnDef="assignee">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="!px-6 !py-4 !text-left !font-medium !text-gray-400 !text-sm !bg-black !whitespace-nowrap !border-gray-800"
            >
              Assignee
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !whitespace-nowrap !bg-gray-950 !text-gray-100 !border-gray-800 cursor-pointer"
              (click)="viewIssue(issue)"
            >
              <span *ngIf="issue.assignee" class="text-gray-300 text-sm">{{ issue.assignee }}</span>
              <span *ngIf="!issue.assignee" class="text-gray-600 text-sm">Unassigned</span>
            </td>
          </ng-container>

          <!-- Updated At Column -->
          <ng-container matColumnDef="updatedAt">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="!px-6 !py-4 !text-left !font-medium !text-gray-400 !text-sm !bg-black !whitespace-nowrap !border-gray-800"
            >
              Updated
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !whitespace-nowrap !bg-gray-950 !text-gray-100 !border-gray-800 cursor-pointer"
              (click)="viewIssue(issue)"
            >
              <span *ngIf="issue.updated_at" class="text-gray-500 text-sm">{{ issue.updated_at | date : 'MMM d' }}</span>
              <span *ngIf="!issue.updated_at" class="text-gray-600 text-sm">—</span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="!px-6 !py-4 !text-center !font-medium !text-gray-400 !text-sm !bg-black !whitespace-nowrap !border-gray-800"
            >
              Actions
            </th>
            <td
              mat-cell
              *matCellDef="let issue"
              class="!px-6 !py-4 !text-center !whitespace-nowrap !bg-gray-950 !text-gray-100 !border-gray-800"
            >
              <div class="flex justify-center items-center gap-1" (click)="$event.stopPropagation()">
                <button
                  mat-icon-button
                  (click)="editIssue(issue); $event.stopPropagation()"
                  class="!text-gray-500 hover:!text-gray-300 !w-8 !h-8"
                  matTooltip="Edit issue"
                >
                  <mat-icon class="!text-lg">edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="deleteIssue(issue); $event.stopPropagation()"
                  class="!text-gray-500 hover:!text-red-400 !w-8 !h-8"
                  matTooltip="Delete issue"
                >
                  <mat-icon class="!text-lg">delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="!bg-black !border-b !border-gray-800"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="hover:!bg-gray-900 !transition-all !duration-200 !border-b !border-gray-800 last:!border-b-0 !bg-gray-950 cursor-pointer"
            (click)="viewIssue(row)"
          ></tr>
        </table>
      </div>

      <!-- Mobile Card View (visible only on mobile) -->
      <div class="lg:hidden">
        <div class="divide-y divide-gray-800">
          <div
            *ngFor="let issue of dataSource.filteredData"
            class="p-4 bg-gray-950 hover:bg-gray-900 transition-colors duration-200 cursor-pointer"
            (click)="viewIssue(issue)"
          >
            <!-- Mobile Issue Card -->
            <div class="space-y-3">
              <!-- Title & ID Row -->
              <div class="flex items-start justify-between gap-3">
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-gray-100 text-base leading-tight line-clamp-2">
                    {{ issue.title }}
                  </h3>
                  <p class="text-gray-600 text-xs font-mono mt-1">#{{ truncateId(issue.id) }}</p>
                </div>
                <!-- Mobile Actions -->
                <div class="flex items-center gap-1 flex-shrink-0" (click)="$event.stopPropagation()">
                  <button
                    mat-icon-button
                    (click)="editIssue(issue); $event.stopPropagation()"
                    class="!text-gray-500 hover:!text-gray-300 !w-8 !h-8"
                    matTooltip="Edit"
                  >
                    <mat-icon class="!text-base">edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    (click)="deleteIssue(issue); $event.stopPropagation()"
                    class="!text-gray-500 hover:!text-red-400 !w-8 !h-8"
                    matTooltip="Delete"
                  >
                    <mat-icon class="!text-base">delete</mat-icon>
                  </button>
                </div>
              </div>

              <!-- Status & Priority Row -->
              <div class="flex items-center gap-2 flex-wrap">
                <span
                  class="inline-flex items-center px-2.5 py-1.5 rounded-full text-xs font-medium border"
                  [ngStyle]="getStatusStyles(issue.status)"
                >
                  {{ issue.status | titlecase }}
                </span>
                <span
                  class="inline-flex items-center px-2.5 py-1.5 rounded-full text-xs font-medium border"
                  [ngStyle]="getPriorityStyles(issue.priority)"
                >
                  {{ issue.priority | titlecase }}
                </span>
              </div>

              <!-- Description (if exists) -->
              <p *ngIf="issue.description" class="text-gray-500 text-sm leading-relaxed line-clamp-2">
                {{ issue.description | slice : 0 : 120 }}{{ issue.description.length > 120 ? '...' : '' }}
              </p>

              <!-- Meta Info Row -->
              <div class="flex items-center justify-between text-xs text-gray-500">
                <div class="flex items-center gap-4">
                  <span *ngIf="issue.assignee; else unassignedMobile">
                    <mat-icon class="!text-xs text-gray-600 mr-1">person</mat-icon>
                    {{ issue.assignee }}
                  </span>
                  <ng-template #unassignedMobile>
                    <span class="text-gray-600">
                      <mat-icon class="!text-xs text-gray-600 mr-1">person_outline</mat-icon>
                      Unassigned
                    </span>
                  </ng-template>
                </div>
                <span *ngIf="issue.updated_at" class="text-gray-600">
                  {{ issue.updated_at | date : 'MMM d, y' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Pagination with Visible Text -->
      <div class="!border-t !border-gray-800 !bg-black">
        <mat-paginator
          [pageSizeOptions]="pageSizeOptions"
          [pageSize]="pageSize"
          showFirstLastButtons
          class="!bg-black"
        >
        </mat-paginator>
      </div>
    </div>
  </div>
</div>

<style>
/* Fix pagination text visibility */
::ng-deep .mat-mdc-paginator {
  color: #d1d5db !important; /* gray-300 */
}

::ng-deep .mat-mdc-paginator .mat-mdc-paginator-range-label {
  color: #d1d5db !important; /* gray-300 */
  font-size: 0.75rem !important;
}

::ng-deep .mat-mdc-paginator .mat-mdc-icon-button {
  color: #9ca3af !important; /* gray-400 */
}

::ng-deep .mat-mdc-paginator .mat-mdc-icon-button:not([disabled]):hover {
  color: #d1d5db !important; /* gray-300 */
  background-color: #1f2937 !important; /* gray-800 */
}

::ng-deep .mat-mdc-paginator .mat-mdc-icon-button[disabled] {
  color: #6b7280 !important; /* gray-500 */
}

::ng-deep .mat-mdc-paginator .mat-mdc-select {
  color: #d1d5db !important; /* gray-300 */
}

::ng-deep .mat-mdc-paginator .mat-mdc-select-value {
  color: #d1d5db !important; /* gray-300 */
}
</style>
